<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>YB Project Tracker</title>
<style>
body{font-family:Arial;margin:0;background:#f4f6f8}
header{background:#1f2937;color:white;padding:12px 16px;font-weight:bold}
#container{display:flex;height:calc(100vh - 48px)}
#sidebar{width:260px;background:#111827;color:white;padding:12px;overflow:auto}
#main{flex:1;padding:16px;overflow:auto}
button{padding:6px 10px;margin:4px 0;cursor:pointer}
.card{background:white;padding:12px;margin:8px 0;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
input,select,textarea{width:100%;margin:4px 0;padding:6px}
.status-Ongoing{color:#f59e0b;font-weight:bold}
.status-Pending{color:#3b82f6;font-weight:bold}
.status-Completed{color:#10b981;font-weight:bold}
.status-OnHold{color:#ef4444;font-weight:bold}
table{width:100%;border-collapse:collapse}
td,th{border:1px solid #ddd;padding:6px}
.section{margin-top:20px}
</style>
</head>
<body>
<header>YB Commercial Tracker (CST)</header>
<div id="container">
<div id="sidebar">
<h3>Projects</h3>
<button onclick="addProject()">+ Add Project</button>
<div id="projectList"></div>
</div>
<div id="main">
<h2>Dashboard</h2>
<div id="dashboard"></div>
</div>
</div>
<script>
let data=JSON.parse(localStorage.getItem('ybdata')||'{"projects":[]}');
function save(){localStorage.setItem('ybdata',JSON.stringify(data));render();}
function addProject(){
const name=prompt('Project name');
if(!name)return;
data.projects.push({name,address:'',pm:'',status:'Ongoing',estimates:[],materials:[]});
save();}
function render(){renderSidebar();renderDashboard();}
function renderSidebar(){
const list=document.getElementById('projectList');list.innerHTML='';
data.projects.forEach((p,i)=>{
const d=document.createElement('div');
d.innerHTML=`<div class='card' onclick='openProject(${i})'><b>${p.name}</b><br><span class='status-${p.status.replace(' ','')||'Ongoing'}'>${p.status}</span></div>`;
list.appendChild(d);
});}
function renderDashboard(){
const dash=document.getElementById('dashboard');dash.innerHTML='';
data.projects.forEach(p=>{
const d=document.createElement('div');
d.className='card';
d.innerHTML=`<b>${p.name}</b><br>PM: ${p.pm||'-'}<br>Status: ${p.status}`;
dash.appendChild(d);
});}
function openProject(i){
const p=data.projects[i];
const main=document.getElementById('main');
main.innerHTML=`<h2>${p.name}</h2>
<label>Address<input value='${p.address}' onchange='data.projects[${i}].address=this.value;save()'></label>
<label>Project Manager<input value='${p.pm}' onchange='data.projects[${i}].pm=this.value;save()'></label>
<label>Status<select onchange='data.projects[${i}].status=this.value;save()'>
<option ${p.status=='Ongoing'?'selected':''}>Ongoing</option>
<option ${p.status=='Pending'?'selected':''}>Pending</option>
<option ${p.status=='OnHold'?'selected':''}>OnHold</option>
<option ${p.status=='Completed'?'selected':''}>Completed</option>
</select></label>
<div class='section'><h3>Estimates</h3><button onclick='addEstimate(${i})'>+ Estimate</button><div id='estimates'></div></div>
<div class='section'><h3>Materials</h3><button onclick='addMaterial(${i})'>+ Material</button><div id='materials'></div></div>`;
renderEstimates(i);renderMaterials(i);
}
function addEstimate(i){data.projects[i].estimates.push({desc:'',jobs:[]});save();openProject(i);} 
function renderEstimates(i){
const p=data.projects[i];const c=document.getElementById('estimates');c.innerHTML='';
p.estimates.forEach((e,ei)=>{
const d=document.createElement('div');d.className='card';
d.innerHTML=`<input placeholder='Description' value='${e.desc}' onchange='data.projects[${i}].estimates[${ei}].desc=this.value;save()'>
<button onclick='addJob(${i},${ei})'>+ Job</button><div id='jobs${ei}'></div>`;
c.appendChild(d);renderJobs(i,ei);
});}
function addJob(i,ei){data.projects[i].estimates[ei].jobs.push({amount:'',reports:[]});save();openProject(i);} 
function renderJobs(i,ei){
const e=data.projects[i].estimates[ei];const jc=document.getElementById('jobs'+ei);
jc.innerHTML='';
e.jobs.forEach((j,ji)=>{
const d=document.createElement('div');d.className='card';
d.innerHTML=`Amount <input value='${j.amount}' onchange='data.projects[${i}].estimates[${ei}].jobs[${ji}].amount=this.value;save()'>
<button onclick='addReport(${i},${ei},${ji})'>+ Report</button><table><tr><th>Date</th><th>Tech</th><th>Note</th></tr>${j.reports.map((r,ri)=>`<tr><td>${r.date}</td><td><input value='${r.tech}' onchange='data.projects[${i}].estimates[${ei}].jobs[${ji}].reports[${ri}].tech=this.value;save()'></td><td><input value='${r.note}' onchange='data.projects[${i}].estimates[${ei}].jobs[${ji}].reports[${ri}].note=this.value;save()'></td></tr>`).join('')}</table>`;
jc.appendChild(d);
});}
function addReport(i,ei,ji){const d=new Date().toLocaleDateString('en-US',{timeZone:'America/Chicago'});data.projects[i].estimates[ei].jobs[ji].reports.push({date:d,tech:'',note:''});save();openProject(i);} 
function addMaterial(i){data.projects[i].materials.push({date:new Date().toLocaleDateString('en-US',{timeZone:'America/Chicago'}),status:'Ordered',desc:''});save();openProject(i);} 
function renderMaterials(i){
const p=data.projects[i];const c=document.getElementById('materials');c.innerHTML='';
p.materials.forEach((m,mi)=>{
const d=document.createElement('div');d.className='card';
d.innerHTML=`${m.date} <input value='${m.desc}' placeholder='Description' onchange='data.projects[${i}].materials[${mi}].desc=this.value;save()'>
<select onchange='data.projects[${i}].materials[${mi}].status=this.value;save()'>
<option ${m.status=='Ordered'?'selected':''}>Ordered</option>
<option ${m.status=='Delivered'?'selected':''}>Delivered</option>
<option ${m.status=='Tech purchased'?'selected':''}>Tech purchased</option>
</select>`;
c.appendChild(d);
});}
render();
</script>
</body>
</html>